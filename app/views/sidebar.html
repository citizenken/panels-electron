<div ng-controller="SidebarCtrl as sidebar">
  <div class="grid grid-row-no-margin" ng-if="!sidebar.inspectHistory">
    <div class="row">
      <div class="profile-container">
        <img ng-if="sidebar.user" class="avatar img-responsive img-circle" ng-src="{{ sidebar.user.photoURL }}"></img>
        <div ng-if="sidebar.user" class="profile-text">
          <span>{{ sidebar.user.displayName }}</span>
          <br>
          <a class="pointer" ng-click="sidebar.signOut()">Sign out</a>
        </div>
        <div ng-if="!sidebar.user && workspace.online" class="profile-text">
          <a class="pointer" ng-click="sidebar.signIn()">Sign in</a>
        </div>
        <div ng-if="!sidebar.user && !workspace.online" class="profile-text">
          <span>No internet connection</span>
          <br>
          <span>Working offline</span>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="profile-container">
        <h4>Your files:</h4>
      </div>
    </div>
    <div class="row">
      <uib-accordion close-others="true">
        <div uib-accordion-group ng-repeat="file in workspace.files" class="panel-modifications panel-default" is-open="sidebar.openAccordion[file.id]">
          <uib-accordion-heading>
            <p>{{ file.title || 'Untitled ' + file.type }}<span class="current-dot" ng-if="file.id == workspace.workingFile.id"></span></p>
          </uib-accordion-heading>
          <ul class="list-inline">
            <li>
              <button type="button" class="btn btn-default"
              ng-click="sidebar.openAccordion[file.id] = false; workspace.changeFile(file.id)">
                <span class="glyphicon glyphicon-edit"></span>
              </button>
            </li>
            <li>
              <button type="button" class="btn btn-default">
                <span class="glyphicon glyphicon-time"></span>
              </button>
            </li>
            <li>
              <button type="button" class="btn btn-default" ng-click="sidebar.showDetail(file.id)">
                <span class="glyphicon glyphicon-share"></span>
              </button>
            </li>
            <li>
              <toggle ng-model="file.sync" ng-disabled="!workspace.online" ng-change="sidebar.setSync(file.id)"
              on="<span class='glyphicon glyphicon-cloud-upload'></span>"
              off="<span class='glyphicon glyphicon-cloud-upload'></span>"></toggle>
            </li>
          </ul>
          <a class="info-link" ng-click="sidebar.showDetail(file.id)" ng-if="sidebar.detail != file.id">Show details</a>
          <a class="info-link" ng-click="sidebar.showDetail(file.id)" ng-if="sidebar.detail == file.id">Hide details</a>
          <div ng-show="sidebar.detail == file.id">
            <table class="table table-striped table-condensed">
              <tbody>
                <tr>
                  <td>Script type</td>
                  <td>{{ file.type }}</td>
                </tr>
                <tr>
                  <td>Created on</td>
                  <td>{{ file.createdOn | date : 'shortDate' }}</td>
                </tr>
                <tr>
                  <td>Last modified</td>
                  <td>{{ file.modifiedOn | date : 'short' }}</td>
                </tr>
                <tr>
                  <td>Author</td>
                  <td>{{ sidebar.users[file.author].displayName }}</td>
                </tr>
                <tr ng-if="sidebar.users">
                  <td>Collaborators</td>
                  <td>
                    <ul ng-repeat="(key, value) in file.collaborators">
                     <li>{{ sidebar.users[key].displayName }}</li>
                    </ul>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <!-- <p ng-click="sidebar.showHistory(file)">History</p> -->
          <!-- <uib-accordion close-others="true">
            <div uib-accordion-group>
              <uib-accordion-heading>Details</uib-accordion-heading>
              <p>Sync remotely <input type="checkbox" name="" value="{{ file.sync }}"/></p>
              <p>Script type: {{ file.type }}</p>
              <p>Created on: {{ file.createdOn | date : 'shortDate' }}</p>
              <p>Last modified:</br>{{ file.modifiedOn | date : 'short' }}</p>
            </div>
          </uib-accordion>
        </div>
      </uib-accordion> -->
    </div>
  </div>
  <div class="grid" ng-if="sidebar.inspectHistory">
    <ul class="list-group">
      <li class="list-group-item" ng-repeat="history in sidebar.inspectHistory.history track by $index| orderBy:'modifiedOn'">
        <p>{{ history.modifiedOn | date : 'short' }}</p>
      </li>
  </div>
</div>